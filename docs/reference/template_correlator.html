<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Acoustic templates correlator using time-frequency cross-correlation — template_correlator • ohun</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Acoustic templates correlator using time-frequency cross-correlation — template_correlator"><meta property="og:description" content="template_correlator estimates templates cross-correlation across multiple sound files."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ohun</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/ohun.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/maRce10/ohun/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Acoustic templates correlator using time-frequency cross-correlation</h1>
    <small class="dont-index">Source: <a href="https://github.com/maRce10/ohun/blob/HEAD/R/template_correlator.R" class="external-link"><code>R/template_correlator.R</code></a></small>
    <div class="hidden name"><code>template_correlator.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>template_correlator</code> estimates templates cross-correlation across multiple sound files.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">template_correlator</span><span class="op">(</span><span class="va">templates</span>, files <span class="op">=</span> <span class="cn">NULL</span>, hop.size <span class="op">=</span> <span class="fl">11.6</span>, wl <span class="op">=</span> <span class="cn">NULL</span>, ovlp <span class="op">=</span> <span class="fl">0</span>,
wn <span class="op">=</span><span class="st">'hanning'</span>, cor.method <span class="op">=</span> <span class="st">"pearson"</span>, parallel <span class="op">=</span> <span class="fl">1</span>, path <span class="op">=</span> <span class="st">"."</span>,
pb <span class="op">=</span> <span class="cn">TRUE</span>, type <span class="op">=</span> <span class="st">"fourier"</span>, fbtype <span class="op">=</span> <span class="st">"mel"</span>, <span class="va">...</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>templates</dt>
<dd><p>'selection_table', 'extended_selection_table' (warbleR package's formats, see <code><a href="https://marce10.github.io/warbleR/reference/selection_table.html" class="external-link">selection_table</a></code>) or data frame with time and frequency information of the signal(s) to be used as templates (1 template per row). The object must containing columns for sound files (sound.files),
selection number (selec), and start and end time of signal (start and end). If frequency range columns are included ('bottom.freq' and 'top.freq', in kHz) the correlation will be run on those frequency ranges. All templates must have the same sampling rate and both templates and 'files' (in which to find templates) must also have the same sampling rate.</p></dd>


<dt>files</dt>
<dd><p>Character vector with the selections in 'X' to be used as surveys for cross-correlation detection. To refer to specific selections in 'X' the user must use the format "sound.file-selec" (e.g. "file1.wav-1"). If only the sound file name is included then the entire sound file is used as survey.</p></dd>


<dt>hop.size</dt>
<dd><p>A numeric vector of length 1 specifying the time window duration (in ms). Default is 11.6 ms, which is equivalent to 512 wl for a 44.1 kHz sampling rate. Ignored if 'wl' is supplied.</p></dd>


<dt>wl</dt>
<dd><p>A numeric vector of length 1 specifying the window length of the spectrogram. Default is <code>NULL</code>. If supplied, 'hop.size' is ignored.</p></dd>


<dt>ovlp</dt>
<dd><p>Numeric vector of length 1 specifying % of overlap between two
consecutive windows, as in <code><a href="https://rdrr.io/pkg/seewave/man/spectro.html" class="external-link">spectro</a></code>. Default is 0. High values of ovlp
slow down the function but may produce more accurate results.</p></dd>


<dt>wn</dt>
<dd><p>A character vector of length 1 specifying the window name as in <code><a href="https://rdrr.io/pkg/seewave/man/ftwindow.html" class="external-link">ftwindow</a></code>.</p></dd>


<dt>cor.method</dt>
<dd><p>A character vector of length 1 specifying the correlation method as in <code><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></code>.</p></dd>


<dt>parallel</dt>
<dd><p>Numeric. Controls whether parallel computing is applied.
It specifies the number of cores to be used. Default is 1 (i.e. no parallel computing).</p></dd>


<dt>path</dt>
<dd><p>Character string containing the directory path where the sound files are located.
The current working directory is used as default.</p></dd>


<dt>pb</dt>
<dd><p>Logical argument to control progress bar. Default is <code>TRUE</code>.</p></dd>


<dt>type</dt>
<dd><p>A character vector of length 1 specifying the type of cross-correlation: "fourier" (i.e. spectrographic cross-correlation using Fourier transform; internally using <code><a href="https://rdrr.io/pkg/seewave/man/spectro.html" class="external-link">spectro</a></code>; default), "mfcc" (auditory scale coefficient matrix cross-correlation; internally using <code><a href="https://rdrr.io/pkg/tuneR/man/melfcc.html" class="external-link">melfcc</a></code>) or "auditory-spectrum" (cross-correlation of auditory spectrum, i.e. spectrum after transformation to an auditory scale; internally using <code><a href="https://rdrr.io/pkg/tuneR/man/melfcc.html" class="external-link">melfcc</a></code>). The argument 'fbtype' controls the auditory scale to be used. Note that the last 2 methods have not been widely used in this context so can be regarded as experimental.</p></dd>


<dt>fbtype</dt>
<dd><p>Character vector indicating the auditory frequency scale to use: "mel", "bark", "htkmel", "fcmel".</p></dd>


<dt>...</dt>
<dd><p>Additional arguments to be passed to <code><a href="https://rdrr.io/pkg/tuneR/man/melfcc.html" class="external-link">melfcc</a></code> for further customization when using auditory scales.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>The function returns an object of class 'template_correlations' which is a list with the correlation scores for each combination of templates and files. 'template_correlations' objects must be used to infer signal ocurrences using <code><a href="template_detector.html">template_detector</a></code> or to graphically explore template correlations across sound files using <code><a href="https://marce10.github.io/warbleR/reference/full_spectrograms.html" class="external-link">full_spectrograms</a></code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function calculates the similarity of acoustic templates across sound files by means of time-frequency cross-correlation. Fourier tranformation, time-frequency representations from auditory scales (including ceptral coefficients) can be used. Several templates can be run over several sound files. Note that template-based detection is divided in two steps: template correlation (using this function) and template detection (or peak detection as it infers detection based on peak correlation scores, using the function <code><a href="template_detector.html">template_detector</a></code>). So the output of this function (and object of 'template_correlations') must be input into <code><a href="template_detector.html">template_detector</a></code> for infering signal ocurrences. <code><a href="optimize_template_detector.html">optimize_template_detector</a></code> can be used to optimize template detection.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Araya-Salas, M. (2021), ohun: automatic detection of acoustic signals. R package version 0.1.0.Khanna H., Gaunt S.L.L.  &amp; McCallum D.A. (1997). Digital spectrographic cross-correlation: tests of recall. Bioacoustics 7(3): 209-234.Lyon, R. H., &amp; Ordubadi, A. (1982). Use of cepstra in acoustical signal analysis. Journal of Mechanical Design, 104(2), 303-306.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="energy_detector.html">energy_detector</a></code>, <code><a href="template_detector.html">template_detector</a></code>, <code><a href="optimize_template_detector.html">optimize_template_detector</a></code></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Marcelo Araya-Salas <a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="op">{</span>
<span class="co">#load example data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lbh1"</span>, <span class="st">"lbh2"</span>, <span class="st">"lbh_reference"</span><span class="op">)</span>

<span class="co">#save sound files</span>
<span class="fu"><a href="https://rdrr.io/pkg/tuneR/man/writeWave.html" class="external-link">writeWave</a></span><span class="op">(</span><span class="va">lbh1</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"lbh1.wav"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/tuneR/man/writeWave.html" class="external-link">writeWave</a></span><span class="op">(</span><span class="va">lbh2</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"lbh2.wav"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># create template</span>
<span class="va">templ</span> <span class="op">&lt;-</span> <span class="va">lbh_reference</span><span class="op">[</span><span class="fl">4</span>,<span class="op">]</span>
<span class="va">templ2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://marce10.github.io/warbleR/reference/selection_table.html" class="external-link">selection_table</a></span><span class="op">(</span><span class="va">templ</span>, extended <span class="op">=</span> <span class="cn">TRUE</span>, confirm.extended <span class="op">=</span> <span class="cn">FALSE</span>,
path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="co"># fourier spectrogram</span>
<span class="op">(</span><span class="va">tc_fr</span> <span class="op">&lt;-</span> <span class="fu">template_correlator</span><span class="op">(</span>templates <span class="op">=</span> <span class="va">templ</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"fourier"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># mel auditory spectrograms</span>
<span class="op">(</span><span class="va">tc_ma</span> <span class="op">&lt;-</span> <span class="fu">template_correlator</span><span class="op">(</span>templates <span class="op">=</span> <span class="va">templ</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"mel-auditory"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># mfcc spectrograms</span>
<span class="op">(</span><span class="va">tc_mfcc</span> <span class="op">&lt;-</span> <span class="fu">template_correlator</span><span class="op">(</span>templates <span class="op">=</span> <span class="va">templ</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"mfcc"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># similar results (but no exactly the same) are found with the 3 methods</span>
<span class="co"># these are the correlation of the correlation vectors</span>
<span class="co"># fourier vs mel-auditory</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">tc_fr</span><span class="op">$</span><span class="va">`lbh2.wav-4/lbh2.wav`</span><span class="op">$</span><span class="va">correlation.scores</span>,
<span class="va">tc_ma</span><span class="op">$</span><span class="va">`lbh2.wav-4/lbh2.wav`</span><span class="op">$</span><span class="va">correlation.scores</span><span class="op">)</span>

<span class="co"># fourier vs mfcc</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">tc_fr</span><span class="op">$</span><span class="va">`lbh2.wav-4/lbh2.wav`</span><span class="op">$</span><span class="va">correlation.scores</span>,
<span class="va">tc_mfcc</span><span class="op">$</span><span class="va">`lbh2.wav-4/lbh2.wav`</span><span class="op">$</span><span class="va">correlation.scores</span><span class="op">)</span>

<span class="co"># mel-auditory vs mfcc</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">tc_ma</span><span class="op">$</span><span class="va">`lbh2.wav-4/lbh2.wav`</span><span class="op">$</span><span class="va">correlation.scores</span>,
<span class="va">tc_mfcc</span><span class="op">$</span><span class="va">`lbh2.wav-4/lbh2.wav`</span><span class="op">$</span><span class="va">correlation.scores</span><span class="op">)</span>

<span class="co"># using an extended selection table</span>
<span class="va">templ_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://marce10.github.io/warbleR/reference/selection_table.html" class="external-link">selection_table</a></span><span class="op">(</span><span class="va">templ</span>, extended <span class="op">=</span> <span class="cn">TRUE</span>, confirm.extended <span class="op">=</span> <span class="cn">FALSE</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">tc_fr_est</span> <span class="op">&lt;-</span> <span class="fu">template_correlator</span><span class="op">(</span>templates <span class="op">=</span> <span class="va">templ_est</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"fourier"</span><span class="op">)</span>

<span class="co"># produces the same result as templates in a regular data frame</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">tc_fr</span><span class="op">$</span><span class="va">`lbh2.wav-4/lbh2.wav`</span><span class="op">$</span><span class="va">correlation.scores</span>,
<span class="va">tc_fr_est</span><span class="op">$</span><span class="va">`lbh2.wav_4-1/lbh2.wav`</span><span class="op">$</span><span class="va">correlation.scores</span><span class="op">)</span>
<span class="op">}</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Marcelo Araya-Salas.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.</p>
</div>

      </footer></div>

  


  

  </body></html>

