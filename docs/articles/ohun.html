<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
<center><font size="7"><b><i>ohun</i>: Automatic detection of acoustic signals</b></font></center> • ohun</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="&lt;center&gt;&lt;font size=">
</head>
<body>
<b><i>ohun</i>: Automatic detection of acoustic signals</b>" /&gt;
<meta property="og:description" content="ohun">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ohun</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ohun.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">vignettes</li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/maRce10/ohun/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ohun_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip><center>
<font size="7"><b><i>ohun</i>: Automatic detection of acoustic signals</b></font>
</center></h1>
                        <h4 class="author"><center>
<a href="https://marceloarayasalas.weebly.com">Marcelo Araya-Salas, PhD</a>
</center></h4>
            
            <h4 class="date"><center>
“2021-09-09”
</center></h4>
      
      <small class="dont-index">Source: <a href="https://github.com/maRce10/ohun/blob/master/vignettes/ohun.Rmd"><code>vignettes/ohun.Rmd</code></a></small>
      <div class="hidden name"><code>ohun.Rmd</code></div>

    </div>

    
    
<!-- <script> -->
<!--    $(document).ready(function() { -->
<!--      $head = $('#header'); -->
<!--      $head.prepend('<img src=\"logo.png\"/>') -->
<!--    }); -->
<!-- </script> -->
<!-- &nbsp;  -->
<p> </p>
<p><a href="https://github.com/maRce10/ohun">ohun</a> is intended to facilitate the automatic detection of acoustic signals, providing functions to diagnose and optimize detection routines. Detections from other software can also be explored and optimized.</p>
<p> </p>
<div class="alert alert-info">
<p><font size="4">The main features of the package are: </font></p>
<ul>
<li>The use of reference annotations for detection optimization and diagnostic</li>
<li>The use of signal detection theory diagnostic parameters to evaluate detection performance</li>
<li>The batch processing of sound files for improving computational performance</li>
</ul>
<p> </p>
<p><font size="4">The package offers functions for: </font></p>
<ul>
<li>Energy-based detection</li>
<li>Template-based detection</li>
<li>Diagnose detection precision</li>
<li>Optimize detection routines based on reference annotations</li>
</ul>
</div>
<p>All functions allow the parallelization of tasks, which distributes the tasks among several processors to improve computational efficiency. The package works on sound files in ‘.wav’, ‘.mp3’, ‘.flac’ and ‘.wac’ format.</p>
<hr>
<p>To install the latest developmental version from <a href="https://github.com/">github</a> you will need the R package <a href="https://cran.r-project.org/package=devtools">devtools</a>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install pacakge</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"maRce10/ohun"</span><span class="op">)</span>

<span class="co">#load package</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://marce10.github.io/ohun/">ohun</a></span><span class="op">)</span></code></pre></div>
<p> </p>
<hr>
<div id="energy-based-detection" class="section level2">
<h2 class="hasAnchor">
<a href="#energy-based-detection" class="anchor"></a>Energy-based detection</h2>
<p>It uses amplitude envelopes to infer the position of signals. These detectors don’t require highly stereotyped signals, although they work better on high quality recordings in which the amplitude of target signals is higher than the background noise (i.e. high signal-to-noise ratio). The function <code>ernergy_detector()</code> performs this type of detection. The syntax <code>package.name::function.name()</code> will be used here and throughout the vignette to highlight functions coming from packages other than <a href="https://github.com/maRce10/ohun">ohun</a>,</p>
<p> </p>
<div id="how-it-works" class="section level3">
<h3 class="hasAnchor">
<a href="#how-it-works" class="anchor"></a>How it works</h3>
<p>We can understand how to use <code>ernergy_detector()</code> using simulating animal signals. We will do that using the function <code>simulate_songs()</code> from <a href="https://CRAN.R-project.org/package=warbleR">warbleR</a>. In this example we simulate a recording with 10 sounds with 2 different frequency ranges and durations:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install this package first if not available</span>
<span class="co"># install.packages(" Sim.DiffProc")</span>

<span class="co">#Creating vector for duration </span>
<span class="va">durs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span>

<span class="co">#Creating simulated song</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="va">ss1</span> <span class="op">&lt;-</span> <span class="fu">warbleR</span><span class="fu">::</span><span class="fu"><a href="https://marce10.github.io/warbleR/reference/simulate_songs.html">simulate_songs</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, durs <span class="op">=</span> <span class="va">durs</span>, freqs <span class="op">=</span> <span class="fl">5</span>, sig2 <span class="op">=</span> <span class="fl">0.01</span>, gaps <span class="op">=</span> <span class="fl">0.5</span>, selec.table <span class="op">=</span> <span class="cn">TRUE</span>, file.name <span class="op">=</span> <span class="st">"ss1"</span>, harms <span class="op">=</span> <span class="fl">1</span>, bgn <span class="op">=</span> <span class="fl">0.1</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p> </p>
<p>This is how the simulated recording looks like:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot spectrogram</span>
<span class="fu">seewave</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/seewave/man/spectro.html">spectro</a></span><span class="op">(</span><span class="va">ss1</span><span class="op">$</span><span class="va">wave</span>, osc <span class="op">=</span> <span class="cn">FALSE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span>, collevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">45</span>, <span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>, fastdisp <span class="op">=</span> <span class="cn">TRUE</span>, flim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, grid <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="ohun_files/figure-html/unnamed-chunk-3-1.png" width="700" style="display: block; margin: auto;">  </p>
<p>The signals in that recording can be detected using <code>ernergy_detector()</code> as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Detecting all elements</span>
<span class="va">sim_ad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/energy_detector.html">energy_detector</a></span><span class="op">(</span>files <span class="op">=</span> <span class="va">ss1</span><span class="op">$</span><span class="va">selec.table</span><span class="op">$</span><span class="va">sound.files</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, bp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">8</span><span class="op">)</span>, ssmooth <span class="op">=</span> <span class="fl">10</span>, threshold <span class="op">=</span> <span class="fl">0.5</span>, min.duration <span class="op">=</span> <span class="fl">0.001</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>, pb <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># plot spectro</span>
<span class="fu">seewave</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/seewave/man/spectro.html">spectro</a></span><span class="op">(</span><span class="va">ss1</span><span class="op">$</span><span class="va">wave</span>, osc <span class="op">=</span> <span class="cn">FALSE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span>, collevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">45</span>, <span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>, fastdisp <span class="op">=</span> <span class="cn">TRUE</span>, flim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>

<span class="co"># plot detections</span>
<span class="kw">for</span><span class="op">(</span><span class="va">e</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sim_ad</span><span class="op">)</span><span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sim_ad</span><span class="op">$</span><span class="va">start</span><span class="op">[</span><span class="va">e</span><span class="op">]</span>, <span class="va">sim_ad</span><span class="op">$</span><span class="va">end</span><span class="op">[</span><span class="va">e</span><span class="op">]</span><span class="op">)</span>, 
                  each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">0</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span>, border <span class="op">=</span> <span class="st">"#07889B"</span>, 
                  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html">adjustcolor</a></span><span class="op">(</span><span class="st">"#07889B"</span>, alpha.f <span class="op">=</span> <span class="fl">0.12</span><span class="op">)</span>, 
                  lwd <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></code></pre></div>
<p><img src="ohun_files/figure-html/unnamed-chunk-4-1.png" width="700" style="display: block; margin: auto;">  </p>
<p>Now we will make use of some additional arguments to filter out specific signals based on their structural features. For instance we can use the argument <code>minimum.duration</code> to exclude short signals and keep only the longest signals:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Detecting all elements</span>
<span class="va">sim_ad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/energy_detector.html">energy_detector</a></span><span class="op">(</span>files <span class="op">=</span> <span class="va">ss1</span><span class="op">$</span><span class="va">selec.table</span><span class="op">$</span><span class="va">sound.files</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, bp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">8</span><span class="op">)</span>, ssmooth <span class="op">=</span> <span class="fl">10</span>, threshold <span class="op">=</span> <span class="fl">0.5</span>, min.duration <span class="op">=</span> <span class="fl">0.6</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>, pb <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># plot spectrogram</span>
<span class="fu">seewave</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/seewave/man/spectro.html">spectro</a></span><span class="op">(</span><span class="va">ss1</span><span class="op">$</span><span class="va">wave</span>, osc <span class="op">=</span> <span class="cn">FALSE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span>, collevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">50</span>, <span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>, fastdisp <span class="op">=</span> <span class="cn">TRUE</span>, flim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>

<span class="co"># plot detections</span>
<span class="kw">for</span><span class="op">(</span><span class="va">e</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sim_ad</span><span class="op">)</span><span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sim_ad</span><span class="op">$</span><span class="va">start</span><span class="op">[</span><span class="va">e</span><span class="op">]</span>, <span class="va">sim_ad</span><span class="op">$</span><span class="va">end</span><span class="op">[</span><span class="va">e</span><span class="op">]</span><span class="op">)</span>, 
                  each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">0</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span>, border <span class="op">=</span> <span class="st">"#07889B"</span>, 
                  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html">adjustcolor</a></span><span class="op">(</span><span class="st">"#07889B"</span>, alpha.f <span class="op">=</span> <span class="fl">0.12</span><span class="op">)</span>, 
                  lwd <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></code></pre></div>
<p><img src="ohun_files/figure-html/unnamed-chunk-5-1.png" width="700" style="display: block; margin: auto;">  </p>
<p>We can use the argument <code>max.duration</code> to exclude long signals and keep the short signals:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Detecting all elements</span>
<span class="va">sim_ad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/energy_detector.html">energy_detector</a></span><span class="op">(</span>files <span class="op">=</span> <span class="va">ss1</span><span class="op">$</span><span class="va">selec.table</span><span class="op">$</span><span class="va">sound.files</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, bp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">8</span><span class="op">)</span>, ssmooth <span class="op">=</span> <span class="fl">10</span>, threshold <span class="op">=</span> <span class="fl">0.5</span>, min.duration <span class="op">=</span> <span class="fl">0.001</span>, max.duration <span class="op">=</span> <span class="fl">0.6</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>, pb <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># plot spectrogram</span>
<span class="fu">seewave</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/seewave/man/spectro.html">spectro</a></span><span class="op">(</span><span class="va">ss1</span><span class="op">$</span><span class="va">wave</span>, osc <span class="op">=</span> <span class="cn">FALSE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, collevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">50</span>, <span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>, fastdisp <span class="op">=</span> <span class="cn">TRUE</span>, flim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>

<span class="co"># plot detections</span>
<span class="kw">for</span><span class="op">(</span><span class="va">e</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sim_ad</span><span class="op">)</span><span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sim_ad</span><span class="op">$</span><span class="va">start</span><span class="op">[</span><span class="va">e</span><span class="op">]</span>, <span class="va">sim_ad</span><span class="op">$</span><span class="va">end</span><span class="op">[</span><span class="va">e</span><span class="op">]</span><span class="op">)</span>, 
                  each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">0</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span>, border <span class="op">=</span> <span class="st">"#07889B"</span>, 
                  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html">adjustcolor</a></span><span class="op">(</span><span class="st">"#07889B"</span>, alpha.f <span class="op">=</span> <span class="fl">0.12</span><span class="op">)</span>, 
                  lwd <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></code></pre></div>
<p><img src="ohun_files/figure-html/unnamed-chunk-6-1.png" width="700" style="display: block; margin: auto;">  </p>
<p>We can also focus the detection on specific frequency ranges using the argument <code>bp</code> (bandpass). By setting <code>bp = c(5, 8)</code>we can detect those signals found within that frequency range (5-8 kHz), which excludes signals below 5 kHz:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Detecting all elements</span>
<span class="va">sim_ad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/energy_detector.html">energy_detector</a></span><span class="op">(</span>files <span class="op">=</span> <span class="va">ss1</span><span class="op">$</span><span class="va">selec.table</span><span class="op">$</span><span class="va">sound.files</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, bp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">8</span><span class="op">)</span>, ssmooth <span class="op">=</span> <span class="fl">10</span>, threshold <span class="op">=</span> <span class="fl">0.5</span>, min.duration <span class="op">=</span> <span class="fl">0.0001</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>, pb <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># plot spectrogram</span>
<span class="fu">spectro</span><span class="op">(</span><span class="va">ss1</span><span class="op">$</span><span class="va">wave</span>, osc <span class="op">=</span> <span class="cn">FALSE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, collevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">50</span>, <span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>, fastdisp <span class="op">=</span> <span class="cn">TRUE</span>, flim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>

<span class="co"># plot detections</span>
<span class="kw">for</span><span class="op">(</span><span class="va">e</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sim_ad</span><span class="op">)</span><span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sim_ad</span><span class="op">$</span><span class="va">start</span><span class="op">[</span><span class="va">e</span><span class="op">]</span>, <span class="va">sim_ad</span><span class="op">$</span><span class="va">end</span><span class="op">[</span><span class="va">e</span><span class="op">]</span><span class="op">)</span>, 
                  each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">0</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span>, border <span class="op">=</span> <span class="st">"#07889B"</span>, 
                  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html">adjustcolor</a></span><span class="op">(</span><span class="st">"#07889B"</span>, alpha.f <span class="op">=</span> <span class="fl">0.12</span><span class="op">)</span>, 
                  lwd <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></code></pre></div>
<p><img src="ohun_files/figure-html/unnamed-chunk-7-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The same logic can be applied to detect those signals found below 5 kHz. We just need to set <code>bp = (0, 6)</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Detecting all elements</span>
<span class="va">sim_ad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/energy_detector.html">energy_detector</a></span><span class="op">(</span>files <span class="op">=</span> <span class="va">ss1</span><span class="op">$</span><span class="va">selec.table</span><span class="op">$</span><span class="va">sound.files</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, bp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span>, ssmooth <span class="op">=</span> <span class="fl">10</span>, threshold <span class="op">=</span> <span class="fl">0.5</span>, min.duration <span class="op">=</span> <span class="fl">0.0001</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>, pb <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># plot spectrogram</span>
<span class="fu">spectro</span><span class="op">(</span><span class="va">ss1</span><span class="op">$</span><span class="va">wave</span>, osc <span class="op">=</span> <span class="cn">FALSE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, collevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">50</span>, <span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>, fastdisp <span class="op">=</span> <span class="cn">TRUE</span>, flim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>

<span class="co"># plot detections</span>
<span class="kw">for</span><span class="op">(</span><span class="va">e</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sim_ad</span><span class="op">)</span><span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sim_ad</span><span class="op">$</span><span class="va">start</span><span class="op">[</span><span class="va">e</span><span class="op">]</span>, <span class="va">sim_ad</span><span class="op">$</span><span class="va">end</span><span class="op">[</span><span class="va">e</span><span class="op">]</span><span class="op">)</span>, 
                  each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">0</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span>, border <span class="op">=</span> <span class="st">"#07889B"</span>, 
                  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html">adjustcolor</a></span><span class="op">(</span><span class="st">"#07889B"</span>, alpha.f <span class="op">=</span> <span class="fl">0.12</span><span class="op">)</span>, 
                  lwd <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></code></pre></div>
<p><img src="ohun_files/figure-html/unnamed-chunk-8-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Amplitude modulatio (variation in amplitude across a signal) can be problematic for detection based on amplitude envelopes. We can also simulate some amplitude modulation using <code><a href="https://marce10.github.io/warbleR/reference/simulate_songs.html">warbleR::simulate_songs()</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Creating simulated song</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="va">ss2</span> <span class="op">&lt;-</span> <span class="fu">warbleR</span><span class="fu">::</span><span class="fu"><a href="https://marce10.github.io/warbleR/reference/simulate_songs.html">simulate_songs</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, durs <span class="op">=</span> <span class="va">durs</span>, freqs <span class="op">=</span> <span class="fl">5</span>, sig2 <span class="op">=</span> <span class="fl">0.01</span>, gaps <span class="op">=</span> <span class="fl">0.5</span>, selec.table <span class="op">=</span> <span class="cn">TRUE</span>, file.name <span class="op">=</span> <span class="st">"ss1"</span>, harms <span class="op">=</span> <span class="fl">1</span>, bgn <span class="op">=</span> <span class="fl">0.1</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>, steps <span class="op">=</span> <span class="fl">10</span>, am.amps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">0.1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="fu">spectro</span><span class="op">(</span><span class="va">ss2</span><span class="op">$</span><span class="va">wave</span>, osc <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span>, collevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">50</span>, <span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>, fastdisp <span class="op">=</span> <span class="cn">TRUE</span>, flim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p> </p>
<p>When signals have strong amplitude modulation they can be split during detection:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># detect sounds</span>
<span class="va">sim_ad</span> <span class="op">&lt;-</span> <span class="fu">auto_detec</span><span class="op">(</span>flist <span class="op">=</span>  <span class="va">ss2</span><span class="op">$</span><span class="va">selec.table</span><span class="op">$</span><span class="va">sound.files</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, bp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">8</span><span class="op">)</span>, ssmooth <span class="op">=</span> <span class="fl">400</span>, threshold <span class="op">=</span> <span class="fl">50</span>, mindur <span class="op">=</span> <span class="fl">0.001</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="fu">spectro</span><span class="op">(</span><span class="va">ss2</span><span class="op">$</span><span class="va">wave</span>, osc <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span>, collevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">50</span>, <span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>, fastdisp <span class="op">=</span> <span class="cn">TRUE</span>, flim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="co"># plot detection</span>
<span class="kw">for</span><span class="op">(</span><span class="va">e</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sim_ad</span><span class="op">)</span><span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sim_ad</span><span class="op">$</span><span class="va">start</span><span class="op">[</span><span class="va">e</span><span class="op">]</span>, <span class="va">sim_ad</span><span class="op">$</span><span class="va">end</span><span class="op">[</span><span class="va">e</span><span class="op">]</span><span class="op">)</span>, 
                  each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">0</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span>, border <span class="op">=</span> <span class="st">"#07889B"</span>, 
                  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html">adjustcolor</a></span><span class="op">(</span><span class="st">"#07889B"</span>, alpha.f <span class="op">=</span> <span class="fl">0.12</span><span class="op">)</span>, 
                  lwd <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></code></pre></div>
<p> </p>
<ul>
<li><p>Use the argument <code>holdtime</code> to merge selections from the same signal</p></li>
<li><p>Try increasing <code>ssmooth</code> to merge selections from the same signal (do not use <code>holdtime</code>)</p></li>
</ul>
<p> </p>
<p>Please cite <a href="https://github.com/maRce10/ohun">ohun</a> as follows:</p>
<p>Araya-Salas, M. (2020), ohun: automatic detection of acoustic signals. R package version 0.1.0.</p>
<p><font size="20">UNDER DEVELOPMENT</font></p>
<p>Observaciones:</p>
<p>avoid having overlapping selections in reference (check with overlapping_sels())</p>
<p>downsample to a freq range just enough for the signals of interest</p>
<p>use hop.size instead of wl</p>
<p>after split_sound_files() another function that returns the position in the original unsplit sound file</p>
<p>count number of detections per unit of time</p>
</div>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<ol style="list-style-type: decimal">
<li>Araya-Salas, M. (2021), ohun: automatic detection of acoustic signals. R package version 0.1.0.</li>
<li>Araya-Salas M, Smith-Vidaurre G (2017) warbleR: An R package to streamline analysis of animal acoustic signals. Methods Ecol Evol 8:184-191.</li>
</ol>
<p> </p>
<hr>
<p><font size="4">Session information</font></p>
<pre><code>## R version 4.1.0 (2021-05-18)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 20.04.2 LTS
## 
## Matrix products: default
## BLAS:   /usr/lib/x86_64-linux-gnu/atlas/libblas.so.3.10.3
## LAPACK: /usr/lib/x86_64-linux-gnu/atlas/liblapack.so.3.10.3
## 
## locale:
##  [1] LC_CTYPE=pt_BR.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=es_CR.UTF-8        LC_COLLATE=pt_BR.UTF-8    
##  [5] LC_MONETARY=es_CR.UTF-8    LC_MESSAGES=pt_BR.UTF-8   
##  [7] LC_PAPER=es_CR.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=es_CR.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] ohun_0.1.0         warbleR_1.1.27     NatureSounds_1.0.4 knitr_1.33        
## [5] seewave_2.1.8      tuneR_1.3.3.1     
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.7        highr_0.9         bslib_0.2.5.1     compiler_4.1.0   
##  [5] jquerylib_0.1.4   Sim.DiffProc_4.8  bitops_1.0-7      tools_4.1.0      
##  [9] digest_0.6.27     jsonlite_1.7.2    evaluate_0.14     memoise_2.0.0    
## [13] fftw_1.0-6        rlang_0.4.11      yaml_2.2.1        parallel_4.1.0   
## [17] pkgdown_1.6.1     xfun_0.25         fastmap_1.1.0     stringr_1.4.0    
## [21] desc_1.3.0        fs_1.5.0          sass_0.4.0        systemfonts_1.0.2
## [25] rprojroot_2.0.2   R6_2.5.0          textshaping_0.3.5 dtw_1.22-3       
## [29] pbapply_1.4-3     rmarkdown_2.9     magrittr_2.0.1    htmltools_0.5.1.1
## [33] MASS_7.3-54       Deriv_4.1.3       ragg_1.1.3        proxy_0.4-26     
## [37] stringi_1.7.4     signal_0.7-7      RCurl_1.98-1.4    cachem_1.0.5     
## [41] crayon_1.4.1      rjson_0.2.20</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Marcelo Araya-Salas.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  
</body>
</html>
